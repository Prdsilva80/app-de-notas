<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
      integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <title>App de Notas</title>
  </head>
  <body>
    <button class="add" id="add"><i class="fas fa-plus"></i> Add note</button>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/marked/1.2.7/marked.min.js"
      integrity="sha512-Sl04EWeJ0QgILm83WoubQbZqh71aWLJP8xnswnKSBI37S+ZtrWVtSHmd1YaYYdC1g9PWN1siY7KO2jU3HtCVHA=="
      crossorigin="anonymous"
    ></script>
    <script>

        const addButton = document.getElementById("add");
        const notes = JSON.parse(localStorage.getItem("notes"));

        const updateLocalStorage = () => {
            const notesText = document.querySelectorAll("textarea");
            const notes = [];
            notesText.forEach((note) => notes.push(note.value));
            localStorage.setItem("notes", JSON.stringify(notes));
        };

        const addNewNote = (text = "") => {
        const note = document.createElement("div");
        note.classList.add("note");
        note.innerHTML = `
    <div class="tools">
        <button class="edit"><i class="fas fa-edit"></i></button>
        <button class="delete"><i class="fas fa-trash-alt"></i></button>
    </div>
        <div class="main ${text ? "" : "hidden"}"></div>
        <textarea class="${text ? "hidden" : ""}"></textarea>`;

        const editButton = note.querySelector(".edit");
        const deleteButton = note.querySelector(".delete");
        const main = note.querySelector(".main");
        const textArea = note.querySelector("textarea");
        textArea.value = text;
        main.innerHTML = marked(text);

        deleteButton.addEventListener("click", () => {
        note.remove();
        updateLocalStorage();
        });
        editButton.addEventListener("click", () => {
        main.classList.toggle("hidden");
        textArea.classList.toggle("hidden");
        });
        textArea.addEventListener("input", (e) => {
        const { value } = e.target;
        main.innerHTML = marked(value);
        updateLocalStorage();
        });
        document.body.appendChild(note);
        };

        addButton.addEventListener("click", () => addNewNote());

        if (notes) {
        notes.forEach((note) => addNewNote(note));
    }

    </script>
    
</body>
</html>